(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();class q{constructor(){this.currentUser=null,this.currentPage=null,this.currentNote=null,this.userData={pages:[],notes:[]},this.isCodeVisible=!1,this.chatSessions=[],this.currentChatId=null,this.eventsInitialized=!1,this.supabaseUrl="https://bchaobnjfrmzvlmqeoge.supabase.co",this.supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJjaGFvYm5qZnJtenZsbXFlb2dlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxMjk0NjMsImV4cCI6MjA2NTcwNTQ2M30.CeH2qS0brRJVCgiskfgTTJwlEqlBMHmc39ZZ8zghtGY";try{this.supabase=supabase.createClient(this.supabaseUrl,this.supabaseKey)}catch{console.warn("Supabase não configurado, usando localStorage apenas"),this.supabase=null}this.customCursor=null,this.currentTheme=localStorage.getItem("rhodium_theme")||"classic",this.toastQueue=[],this.soundEnabled=localStorage.getItem("rhodium_sound")!=="false",this.soundEventsAdded=!1,this.init()}init(){this.setupCustomCursor(),this.setupThemeToggle(),this.setupSoundSystem(),this.bindEvents(),this.checkAuthState(),this.setupTabs(),this.setupTextTools(),this.setupAI(),this.setupDragAndDrop(),this.setupScrollSpy(),this.setupLibrarySystem(),this.setupUploadSystem(),this.setupSearchSystem(),this.setupPDFViewer(),this.setupToastSystem(),this.ensureDefaultTheme()}encrypt(t,e="rhodium_secret_key"){let s="";for(let a=0;a<t.length;a++)s+=String.fromCharCode(t.charCodeAt(a)^e.charCodeAt(a%e.length));return btoa(s)}decrypt(t,e="rhodium_secret_key"){try{const s=atob(t);let a="";for(let o=0;o<s.length;o++)a+=String.fromCharCode(s.charCodeAt(o)^e.charCodeAt(o%e.length));return a}catch(s){return console.error("Decryption error:",s),null}}async loadUserDataFromSupabase(){var t,e,s,a,o,r,c;if(!this.currentUser)return{openaiKey:"",geminiKey:"",preferredAI:"gemini"};if(!this.supabase)return this.userData=this.loadUserDataLocally(),this.chatSessions=this.userData.chatSessions||[this.createNewChat()],this.currentChatId=(t=this.chatSessions[0])==null?void 0:t.id,{openaiKey:((e=this.userData)==null?void 0:e.openaiKey)||"",geminiKey:((s=this.userData)==null?void 0:s.geminiKey)||"",preferredAI:((a=this.userData)==null?void 0:a.preferredAI)||"gemini"};try{const{data:i,error:l}=await this.supabase.from("Codes").select("user_data").eq("code",this.currentUser.code).single();if(l)console.warn("Supabase falhou, carregando local..."),this.userData=this.loadUserDataLocally();else if(i!=null&&i.user_data){const p=this.decrypt(i.user_data);p?this.userData=JSON.parse(p):this.initializeUserData()}else this.initializeUserData()}catch(i){console.warn("Erro de conexão, usando dados locais:",i),this.userData=this.loadUserDataLocally()}if(this.chatSessions=this.userData.chatSessions||[],this.chatSessions.length===0){const i={id:Date.now().toString()+"_default",title:"Nova Conversa",messages:[],createdAt:new Date().toISOString()};this.chatSessions=[i],this.currentChatId=i.id}else this.currentChatId=this.chatSessions[0].id;return{openaiKey:((o=this.userData)==null?void 0:o.openaiKey)||"",geminiKey:((r=this.userData)==null?void 0:r.geminiKey)||"",preferredAI:((c=this.userData)==null?void 0:c.preferredAI)||"gemini"}}async saveUserDataToSupabase(t=null){if(this.currentUser){if(t&&(this.userData={...this.userData,openaiKey:t.openaiKey,geminiKey:t.geminiKey,preferredAI:t.preferredAI}),this.userData.chatSessions=this.chatSessions,this.saveUserDataLocally(this.userData),!this.supabase){console.log("Dados salvos localmente (Supabase não configurado)");return}try{const e=this.encrypt(JSON.stringify(this.userData)),s=new Date().toISOString(),{error:a}=await this.supabase.from("Codes").update({user_data:e,last_saved:s}).eq("code",this.currentUser.code);a?console.error("Erro ao salvar dados no Supabase:",a):console.log("Dados do usuário salvos no Supabase")}catch(e){console.warn("Falha ao salvar no Supabase. Dados salvos localmente:",e)}}}saveUserDataLocally(t){localStorage.setItem("userDataBackup",JSON.stringify(t))}loadUserDataLocally(){const t=localStorage.getItem("userDataBackup");return t?JSON.parse(t):{pages:[],notes:[]}}async generateUniqueCode(){let t,e=!0;const s=JSON.parse(localStorage.getItem("rhodium_offline_users")||"[]");for(;e;){t=Math.random().toString(36).substring(2,10).toUpperCase();const a=s.some(o=>o.code===t);if(!this.supabase)e=a;else try{const{data:o,error:r}=await this.supabase.from("Codes").select("code").eq("code",t).limit(1);r?(console.error("Erro ao verificar código único:",r),e=a):e=o.length>0||a}catch(o){console.warn("Erro de rede, usando verificação local:",o),e=a}}return this.supabase||(s.push({code:t,created_at:new Date().toISOString()}),localStorage.setItem("rhodium_offline_users",JSON.stringify(s))),t}async checkAuthState(){const t=localStorage.getItem("rhodium_current_user");t?(this.currentUser=JSON.parse(t),await this.loadUserDataFromSupabase(),this.showMainApp(),this.renderPages(),this.renderNotes()):this.showLogin()}async register(t){if(!t.trim())return this.showCustomPopup("Por favor, insira um nome válido.","error"),!1;const e=await this.generateUniqueCode(),s={pages:[],notes:[]},a={id:Date.now().toString(),name:t.trim(),code:e,created_at:new Date().toISOString(),last_saved:new Date().toISOString()};if(this.supabase)try{const o=this.encrypt(JSON.stringify(s)),{error:r}=await this.supabase.from("Codes").insert({...a,user_data:o});r&&(console.error("Erro ao criar conta no Supabase:",r),this.showCustomPopup("Erro ao criar conta. Usando modo offline.","warning"))}catch(o){console.warn("Criando conta em modo offline:",o)}return this.currentUser={id:a.id,name:a.name,code:a.code,createdAt:a.created_at,lastSaved:a.last_saved},this.userData=s,localStorage.setItem("rhodium_current_user",JSON.stringify(this.currentUser)),this.saveUserDataLocally(this.userData),this.showMainApp(),this.showGeneratedCode(e),!0}async login(t){const e=t.trim().toUpperCase();if(this.supabase)try{const{data:s,error:a}=await this.supabase.from("Codes").select("*").eq("code",e).single();if(a||!s)return this.showCustomPopup("Código inválido.","error"),!1;this.currentUser={id:s.id,name:s.name,code:s.code,createdAt:s.created_at,lastSaved:s.last_saved}}catch{return this.showCustomPopup("Erro de conexão. Tente novamente.","error"),!1}else{const a=JSON.parse(localStorage.getItem("rhodium_offline_users")||"[]").find(o=>o.code===e);if(!a)return this.showCustomPopup("Código inválido. No modo offline, apenas códigos criados neste dispositivo funcionam.","error"),!1;this.currentUser=a}return localStorage.setItem("rhodium_current_user",JSON.stringify(this.currentUser)),await this.loadUserDataFromSupabase(),this.showMainApp(),this.renderPages(),this.renderNotes(),!0}showGeneratedCode(t){this.showCustomPopup(`Sua conta foi criada com sucesso!<br><br><strong>Seu código de acesso é: ${t}</strong><br><br>Guarde este código com segurança, você precisará dele para fazer login.`,"success",!0)}logout(){this.currentUser=null,this.userData={pages:[],notes:[]},localStorage.removeItem("rhodium_current_user"),this.showLogin()}toggleCodeVisibility(){this.isCodeVisible=!this.isCodeVisible;const t=document.getElementById("userCodeDisplay"),e=document.getElementById("toggleCodeBtn");this.isCodeVisible?(t.textContent=this.currentUser.code,t.classList.add("revealed"),t.style.backdropFilter="none",e.innerHTML='<i class="fas fa-eye-slash"></i>'):(t.textContent="••••••••",t.classList.remove("revealed"),t.style.backdropFilter="blur(8px)",e.innerHTML='<i class="fas fa-eye"></i>')}showLogin(){document.getElementById("loginScreen").classList.add("active"),document.getElementById("registerScreen").classList.remove("active"),document.getElementById("mainApp").classList.remove("active"),this.fadeTo(document.getElementById("mainApp"))}showRegister(){document.getElementById("loginScreen").classList.remove("active"),document.getElementById("registerScreen").classList.add("active"),document.getElementById("mainApp").classList.remove("active"),this.fadeTo(document.getElementById("mainApp"))}showMainApp(){document.getElementById("loginScreen").classList.remove("active"),document.getElementById("registerScreen").classList.remove("active"),document.getElementById("mainApp").classList.add("active"),this.fadeTo(document.getElementById("mainApp")),this.currentUser&&(document.getElementById("userName").textContent=this.currentUser.name,document.getElementById("userCodeDisplay").textContent="••••••••",this.isCodeVisible=!1,this.updateSettingsDisplay(),this.renderChatSessions(),this.renderChatMessages())}updateSettingsDisplay(){var t,e,s;if(this.currentUser){const a=document.getElementById("settingsUserName"),o=document.getElementById("userCodeDisplay");a&&(a.textContent=this.currentUser.name),o&&(o.textContent=this.isCodeVisible?this.currentUser.code:"••••••••",o.style.backdropFilter=this.isCodeVisible?"none":"blur(8px)");const r=document.getElementById("openaiKey"),c=document.getElementById("geminiKey"),i=document.getElementById("preferredAI");r&&(r.value=((t=this.userData)==null?void 0:t.openaiKey)||""),c&&(c.value=((e=this.userData)==null?void 0:e.geminiKey)||""),i&&(i.value=((s=this.userData)==null?void 0:s.preferredAI)||"gemini")}}setupTabs(){const t=document.querySelectorAll(".nav-item");t.forEach(e=>{e.addEventListener("click",()=>{const s=e.dataset.tab;this.showTab(s),t.forEach(a=>a.classList.remove("active")),e.classList.add("active")})})}showTab(t){document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active"));const s=document.getElementById(t);s&&s.classList.add("active"),t==="workspace"?this.renderPages():t==="notes"?this.renderNotes():t==="library"&&this.renderLibrary()}initializeUserData(){this.userData={pages:[],notes:[]},this.saveUserDataToSupabase()}saveUserData(){this.saveUserDataToSupabase()}createPage(t="Nova Página",e=""){const s={id:Date.now().toString(),title:t,content:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.userData.pages.push(s),this.saveUserData(),s}editPage(t){const e=this.userData.pages.find(s=>s.id===t);e&&(this.currentPage=e,this.showPageEditor(e))}savePage(){if(this.currentPage){const t=document.getElementById("pageTitle").value,e=document.getElementById("pageContent").innerHTML;this.currentPage.title=t||"Sem título",this.currentPage.content=e,this.currentPage.updatedAt=new Date().toISOString(),this.currentPage.lastEdited=new Date().toISOString(),this.saveUserData(),this.hidePageEditor(),this.renderPages()}}deletePage(t){this.showCustomConfirm("Tem certeza que deseja excluir esta página?",()=>{this.userData.pages=this.userData.pages.filter(e=>e.id!==t),this.saveUserData(),this.renderPages(),this.showToast("Página excluída com sucesso!","success")})}showPageEditor(t){document.getElementById("pageTitle").value=t.title,document.getElementById("pageContent").innerHTML=t.content,document.getElementById("pageEditor").classList.remove("hidden"),document.getElementById("pagesList").style.display="none"}hidePageEditor(){document.getElementById("pageEditor").classList.add("hidden"),document.getElementById("pagesList").style.display="grid",this.currentPage=null}renderPages(){const t=document.getElementById("pagesList");t.innerHTML="",this.userData.pages.forEach(e=>{const s=document.createElement("div");s.className="page-card drag-item",s.draggable=!0,s.innerHTML=`
              <h3>${e.title}</h3>
              <p>${this.stripHtml(e.content).substring(0,100)}${e.content.length>100?"...":""}</p>
              <div class="page-date">Atualizado em ${new Date(e.updatedAt).toLocaleDateString("pt-BR")}</div>
              <div style="margin-top: 15px;">
                  <button onclick="app.editPage('${e.id}')" class="btn-secondary" style="margin-right: 10px;">EDITAR</button>
                  <button onclick="app.deletePage('${e.id}')" class="btn-secondary" style="background: #000000; color: white;">EXCLUIR</button>
              </div>
          `,t.appendChild(s)})}createNote(t="Nova Nota",e=""){const s=new Date().toISOString(),a={id:Date.now().toString(),title:t,content:e,createdAt:s,lastEdited:s};return this.userData.notes.push(a),this.saveUserData(),this.renderNotes(),a}editNote(t){const e=this.userData.notes.find(s=>s.id===t);e&&(this.currentNote=e,this.showNoteEditor(e))}saveNote(){var t,e;if(this.currentNote){const s=(t=document.getElementById("noteTitle"))==null?void 0:t.value,a=(e=document.getElementById("noteContent"))==null?void 0:e.innerHTML;this.currentNote.title=s||"Sem título",this.currentNote.content=a,this.currentNote.lastEdited=new Date().toISOString(),this.saveUserData(),this.hideNoteEditor(),this.renderNotes()}}deleteNote(t){this.showCustomConfirm("Tem certeza que deseja excluir esta nota?",()=>{this.userData.notes=this.userData.notes.filter(e=>e.id!==t),this.saveUserData(),this.renderNotes(),this.showToast("Nota excluída com sucesso!","success")})}showNoteEditor(t){document.getElementById("noteTitle").value=t.title,document.getElementById("noteContent").innerHTML=t.content,document.getElementById("noteEditor").classList.remove("hidden"),document.getElementById("notesList").style.display="none"}hideNoteEditor(){document.getElementById("noteEditor").classList.add("hidden"),document.getElementById("notesList").style.display="grid",this.currentNote=null}renderNotes(){const t=document.getElementById("notesList");t.innerHTML="",this.userData.notes.forEach(e=>{const s=document.createElement("div");s.className="note-card drag-item",s.draggable=!0;const a=new Date(e.createdAt).toLocaleDateString("pt-BR"),o=e.lastEdited?` • Editado em ${new Date(e.lastEdited).toLocaleString("pt-BR")}`:"";s.innerHTML=`
              <h3>${e.title}</h3>
              <p>${this.stripHtml(e.content).substring(0,150)}${e.content.length>150?"...":""}</p>
              <div class="note-date">Criado em ${a}${o}</div>
              <div style="margin-top: 15px;">
                  <button onclick="app.editNote('${e.id}')" class="btn-secondary" style="margin-right: 10px;">EDITAR</button>
                  <button onclick="app.deleteNote('${e.id}')" class="btn-secondary" style="background: #000000; color: white;">EXCLUIR</button>
              </div>
          `,t.appendChild(s)})}async processPDF(t,e="summarize"){try{document.getElementById("loadingOverlay").classList.remove("hidden");const s=await t.arrayBuffer(),a=await pdfjsLib.getDocument(s).promise;let o="",r={totalPages:a.numPages,pageTexts:[],headings:[],paragraphs:[]};for(let c=1;c<=a.numPages;c++){const p=(await(await a.getPage(c)).getTextContent()).items.map(E=>E.str).join(" ");o+=p+`
`,r.pageTexts.push({page:c,text:p,wordCount:p.split(" ").length})}switch(e){case"summarize":const c=await this.generateSummary(o);document.getElementById("summaryText").textContent=c,document.getElementById("summaryResult").classList.remove("hidden");break;case"extract":document.getElementById("extractedText").textContent=o,document.getElementById("textResult").classList.remove("hidden");break;case"structure":this.analyzeStructure(o,r);break;case"questions":const i=this.generateQuestions(o);document.getElementById("generatedQuestions").innerHTML=i,document.getElementById("questionsResult").classList.remove("hidden");break}}catch(s){console.error("PDF processing error:",s),this.showCustomPopup("Erro ao processar PDF. Verifique se o arquivo é válido.","error")}finally{document.getElementById("loadingOverlay").classList.add("hidden")}}async generateSummary(t){var o,r,c,i,l,p,E,b,C,I,d,m,h;const e=((o=this.userData)==null?void 0:o.openaiKey)||"",s=((r=this.userData)==null?void 0:r.geminiKey)||"",a=((c=this.userData)==null?void 0:c.preferredAI)||"gemini";if(a==="openai"&&e||a==="gemini"&&s)try{const v=`Faça um resumo detalhado e bem estruturado do seguinte texto em português brasileiro:

${t.substring(0,8e3)}`;if(a==="openai"&&e.startsWith("sk-")){const g=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:v}],temperature:.3,max_tokens:1e3})});if(g.ok)return((E=(p=(l=(i=(await g.json()).choices)==null?void 0:i[0])==null?void 0:l.message)==null?void 0:p.content)==null?void 0:E.trim())||this.fallbackSummary(t)}else if(a==="gemini"&&s.startsWith("AIza")){const g=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:v}]}],generationConfig:{temperature:.3,maxOutputTokens:1e3}})});if(g.ok)return((h=(m=(d=(I=(C=(b=(await g.json()).candidates)==null?void 0:b[0])==null?void 0:C.content)==null?void 0:I.parts)==null?void 0:d[0])==null?void 0:m.text)==null?void 0:h.trim())||this.fallbackSummary(t)}}catch(v){console.warn("Erro ao gerar resumo com IA, usando método local:",v)}return this.fallbackSummary(t)}fallbackSummary(t){const e=t.split(/[.!?]+/).filter(i=>i.trim().length>0),s=t.toLowerCase().split(/\s+/),a={};s.forEach(i=>{const l=i.replace(/[^\w]/g,"");l.length>3&&(a[l]=(a[l]||0)+1)});const o=e.map(i=>{const l=i.toLowerCase().split(/\s+/);let p=0;return l.forEach(E=>{const b=E.replace(/[^\w]/g,"");a[b]&&(p+=a[b])}),{sentence:i.trim(),score:p}});o.sort((i,l)=>l.score-i.score);const r=Math.min(8,Math.ceil(e.length*.4));return o.slice(0,r).map(i=>i.sentence).join(". ")+"."}analyzeStructure(t,e){const s=t.split(`
`),a=[],o=[];s.forEach((c,i)=>{const l=c.trim();l.length>0&&(l.length<100&&/^[A-Z]/.test(l)?a.push(`Linha ${i+1}: ${l}`):l.length>50&&o.push(`Parágrafo ${o.length+1}: ${l.substring(0,100)}...`))});const r=`
          <h4>INFORMAÇÕES GERAIS:</h4>
          <p>Total de páginas: ${e.totalPages}</p>
          <p>Total de palavras: ${t.split(" ").length}</p>
          <p>Total de caracteres: ${t.length}</p>

          <h4>POSSÍVEIS TÍTULOS/CABEÇALHOS:</h4>
          <ul>${a.slice(0,10).map(c=>`<li>${c}</li>`).join("")}</ul>

          <h4>ESTRUTURA DE PARÁGRAFOS:</h4>
          <ul>${o.slice(0,5).map(c=>`<li>${c}</li>`).join("")}</ul>
      `;document.getElementById("documentStructure").innerHTML=r,document.getElementById("structureResult").classList.remove("hidden")}generateQuestions(t){const e=t.split(/[.!?]+/).filter(r=>r.trim().length>20),s=this.extractKeywords(t),a=[];return s.slice(0,5).forEach(r=>{a.push(`O que é ${r}?`),a.push(`Como ${r} se relaciona com o tema principal?`)}),e.filter(r=>r.length>50&&r.length<200).slice(0,3).forEach(r=>{r.includes("porque")||r.includes("causa")?a.push(`Por que ${r.split(" ").slice(0,5).join(" ")}...?`):a.push(`Explique: ${r.substring(0,80)}...`)}),a.map((r,c)=>`<p><strong>Pergunta ${c+1}:</strong> ${r}</p>`).join("")}extractKeywords(t){const e=t.toLowerCase().split(/\s+/),s=new Set(["o","a","os","as","um","uma","de","do","da","dos","das","em","no","na","nos","nas","para","por","com","sem","sob","sobre","entre","até","desde","durante","através","mediante","conforme","segundo","perante","ante","após","antes","contra","desde","exceto","salvo","menos","mais","muito","pouco","tanto","quanto","qual","que","quem","onde","quando","como","porque","se","mas","ou","e","nem","também","já","ainda","só","apenas","mesmo","até","inclusive","exclusive"]),a={};return e.forEach(o=>{const r=o.replace(/[^\w]/g,"");r.length>4&&!s.has(r)&&(a[r]=(a[r]||0)+1)}),Object.entries(a).sort((o,r)=>r[1]-o[1]).slice(0,10).map(o=>o[0])}setupTextTools(){var s,a,o,r,c,i,l,p,E,b,C,I;const t=document.getElementById("wordCountText"),e=document.getElementById("formatText");t&&t.addEventListener("input",()=>{const d=t.value,m=d.split(/\s+/).filter(S=>S.length>0),h=d.split(/[.!?]+/).filter(S=>S.trim().length>0),v=d.split(`
`).filter(S=>S.trim().length>0);document.getElementById("charCount").textContent=d.length,document.getElementById("wordCount").textContent=m.length,document.getElementById("paragraphCount").textContent=v.length;const g=h.length>0?Math.round(m.length/h.length):0,f=m.length>0?Math.round(d.replace(/\s/g,"").length/m.length):0,D=Math.ceil(m.length/200),T=document.getElementById("sentenceCount"),B=document.getElementById("avgWords"),y=document.getElementById("avgChars"),w=document.getElementById("readingTime");T&&(T.textContent=h.length),B&&(B.textContent=g),y&&(y.textContent=f),w&&(w.textContent=D+" min")}),(s=document.getElementById("upperCase"))==null||s.addEventListener("click",()=>{const d=e.value;document.getElementById("formatResult").value=d.toUpperCase()}),(a=document.getElementById("lowerCase"))==null||a.addEventListener("click",()=>{const d=e.value;document.getElementById("formatResult").value=d.toLowerCase()}),(o=document.getElementById("titleCase"))==null||o.addEventListener("click",()=>{const d=e.value;document.getElementById("formatResult").value=d.replace(/\w\S*/g,m=>m.charAt(0).toUpperCase()+m.substr(1).toLowerCase())}),(r=document.getElementById("removeSpaces"))==null||r.addEventListener("click",()=>{const d=e.value;document.getElementById("formatResult").value=d.replace(/\s+/g," ").trim()}),(c=document.getElementById("reverseText"))==null||c.addEventListener("click",()=>{const d=e.value;document.getElementById("formatResult").value=d.split("").reverse().join("")}),(i=document.getElementById("removeLineBreaks"))==null||i.addEventListener("click",()=>{const d=e.value;document.getElementById("formatResult").value=d.replace(/\n/g," ").replace(/\s+/g," ").trim()}),(l=document.getElementById("sortLines"))==null||l.addEventListener("click",()=>{const m=e.value.split(`
`).sort();document.getElementById("formatResult").value=m.join(`
`)}),(p=document.getElementById("removeDuplicates"))==null||p.addEventListener("click",()=>{const m=e.value.split(`
`),h=[...new Set(m)];document.getElementById("formatResult").value=h.join(`
`)}),(E=document.getElementById("addLineNumbers"))==null||E.addEventListener("click",()=>{const h=e.value.split(`
`).map((v,g)=>`${g+1}. ${v}`);document.getElementById("formatResult").value=h.join(`
`)}),(b=document.getElementById("extractEmails"))==null||b.addEventListener("click",()=>{const d=e.value,m=/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,h=d.match(m)||[];document.getElementById("formatResult").value=h.join(`
`)}),(C=document.getElementById("extractUrls"))==null||C.addEventListener("click",()=>{const d=e.value,m=/https?:\/\/[^\s]+/g,h=d.match(m)||[];document.getElementById("formatResult").value=h.join(`
`)}),(I=document.getElementById("countWords"))==null||I.addEventListener("click",()=>{const m=e.value.toLowerCase().split(/\s+/).filter(g=>g.length>0),h={};m.forEach(g=>{const f=g.replace(/[^\w]/g,"");f.length>0&&(h[f]=(h[f]||0)+1)});const v=Object.entries(h).sort((g,f)=>f[1]-g[1]).slice(0,20).map(([g,f])=>`${g}: ${f}`).join(`
`);document.getElementById("formatResult").value=`Top 20 palavras mais usadas:

`+v})}setupAI(){document.getElementById("chatMessages"),document.querySelectorAll(".ai-tool-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.prompt;document.getElementById("aiInput").value=e})})}createNewChat(){const t=Date.now().toString()+"_"+Math.random().toString(36).substr(2,9),e={id:t,title:"Nova Conversa",messages:[],createdAt:new Date().toISOString()};return this.chatSessions.unshift(e),this.currentChatId=t,this.renderChatSessions(),this.renderChatMessages(),this.saveUserData(),e}switchChat(t){this.currentChatId=t,this.renderChatMessages()}deleteChat(t){if(this.chatSessions.length<=1){this.showCustomPopup("Você precisa ter pelo menos uma conversa.","warning");return}this.chatSessions=this.chatSessions.filter(e=>e.id!==t),this.currentChatId===t&&(this.currentChatId=this.chatSessions[0].id),this.renderChatSessions(),this.renderChatMessages(),this.saveUserData()}getCurrentChat(){return this.chatSessions.find(t=>t.id===this.currentChatId)||this.chatSessions[0]}renderChatSessions(){const t=document.getElementById("chatSessions");t&&(t.innerHTML="",this.chatSessions.forEach(e=>{const s=document.createElement("div");s.className=`chat-session ${e.id===this.currentChatId?"active":""}`,s.innerHTML=`
              <div class="chat-session-title" onclick="app.switchChat('${e.id}')">${e.title}</div>
              <button class="delete-chat-btn" onclick="app.deleteChat('${e.id}')" title="Excluir conversa">
                  <i class="fas fa-trash"></i>
              </button>
          `,t.appendChild(s)}))}renderChatMessages(){const t=document.getElementById("chatMessages");if(!t)return;t.innerHTML="";const e=this.getCurrentChat();e&&(e.messages.forEach(s=>{const a=document.createElement("div");a.className=`message ${s.role}`,a.innerHTML=s.content,t.appendChild(a)}),t.scrollTop=t.scrollHeight)}async sendAIMessage(){var E,b,C,I,d,m,h,v,g,f,D,T,B;const t=document.getElementById("aiInput"),e=document.getElementById("chatMessages"),s=t.value.trim();if(!s)return;t.value="";const a=this.getCurrentChat();if(!a)return;const o={role:"user",content:s};a.messages.push(o),a.messages.length===1&&(a.title=s.substring(0,30)+(s.length>30?"...":""),this.renderChatSessions());const r=document.createElement("div");r.className="message user",r.innerHTML=this.formatMessage(s),e.appendChild(r);const c=document.createElement("div");c.className="message ai typing",c.innerHTML='<i class="fas fa-circle-notch fa-spin"></i> Pensando...',e.appendChild(c),e.scrollTop=e.scrollHeight;const i=((E=this.userData)==null?void 0:E.openaiKey)||"",l=((b=this.userData)==null?void 0:b.geminiKey)||"",p=((C=this.userData)==null?void 0:C.preferredAI)||"gemini";try{let y="";const w=a.messages.slice(-10);if(p==="openai"&&i)if(!i.startsWith("sk-"))y="Chave da OpenAI inválida. Verifique nas configurações.";else{const x=w.map(L=>({role:L.role==="assistant"?"assistant":"user",content:L.content})),n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:x,temperature:.7,max_tokens:2e3})});if(!n.ok)throw new Error(`OpenAI API Error: ${n.status} ${n.statusText}`);y=((h=(m=(d=(I=(await n.json()).choices)==null?void 0:I[0])==null?void 0:d.message)==null?void 0:m.content)==null?void 0:h.trim())||"Resposta vazia da OpenAI."}else if(p==="gemini"&&l)if(!l.startsWith("AIza"))y="Chave da Gemini inválida. Verifique nas configurações.";else{const x=[];w.forEach(L=>{x.push({parts:[{text:L.content}],role:L.role==="assistant"?"model":"user"})});const n=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:x,generationConfig:{temperature:.7,maxOutputTokens:2e3,topP:.8,topK:10}})});if(!n.ok)throw new Error(`Gemini API Error: ${n.status} ${n.statusText}`);y=((B=(T=(D=(f=(g=(v=(await n.json()).candidates)==null?void 0:v[0])==null?void 0:g.content)==null?void 0:f.parts)==null?void 0:D[0])==null?void 0:T.text)==null?void 0:B.trim())||"Resposta vazia da Gemini."}else y="Nenhuma chave de IA configurada. Vá para Configurações e adicione sua chave da OpenAI ou Gemini.";const S={role:"assistant",content:y};a.messages.push(S),c.className="message ai",c.innerHTML=this.formatMessage(y),this.saveUserData()}catch(y){console.error("Erro ao chamar a IA:",y);const w=`Erro ao gerar resposta da IA: ${y.message}`;c.className="message ai error",c.innerHTML=w,a.messages.push({role:"assistant",content:w})}e.scrollTop=e.scrollHeight}formatMessage(t){let e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e=e.replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/^### (.*$)/gm,"<h3>$1</h3>").replace(/^## (.*$)/gm,"<h2>$1</h2>").replace(/^# (.*$)/gm,"<h1>$1</h1>").replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>").replace(/^\* (.*$)/gm,"<li>$1</li>").replace(/^\- (.*$)/gm,"<li>$1</li>").replace(/^\d+\. (.*$)/gm,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/\n\n/g,"</p><p>").replace(/\n/g,"<br>"),!e.includes("<h")&&!e.includes("<ul")&&!e.includes("<pre")&&(e="<p>"+e+"</p>"),e}generateAIResponse(t){const e={resumir:"Para resumir um texto, identifique as ideias principais e elimine informações redundantes.",traduzir:"Para tradução precisa, considere o contexto e as nuances culturais.",corrigir:"Verificando gramática e ortografia do texto fornecido.",explicar:"Vou explicar o conceito de forma clara e didática."},s=t.toLowerCase();for(const a in e)if(s.includes(a))return e[a];return"Estou aqui para ajudar! Posso resumir textos, traduzir, corrigir gramática ou explicar conceitos. Como posso ajudá-lo?"}stripHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}fadeTo(t){t.classList.remove("fade-in"),t.offsetWidth,t.classList.add("fade-in")}setupCustomCursor(){window.innerWidth<=768||(this.customCursor=document.querySelector(".custom-cursor"),this.customCursor||(this.customCursor=document.createElement("div"),this.customCursor.className="custom-cursor",document.body.appendChild(this.customCursor)),document.addEventListener("mousemove",t=>{this.customCursor.style.left=t.clientX+"px",this.customCursor.style.top=t.clientY+"px"}),document.addEventListener("mousedown",()=>{this.customCursor.classList.add("click"),setTimeout(()=>{this.customCursor.classList.remove("click")},300)}),document.querySelectorAll("button, .nav-item, .page-card, .note-card").forEach(t=>{t.addEventListener("mouseenter",()=>{this.customCursor.classList.add("hover")}),t.addEventListener("mouseleave",()=>{this.customCursor.classList.remove("hover")})}))}setupThemeToggle(){const t=document.querySelectorAll(".theme-btn"),e=document.body;e.setAttribute("data-theme",this.currentTheme),t.forEach(s=>{s.classList.toggle("active",s.dataset.theme===this.currentTheme)}),t.forEach(s=>{s.addEventListener("click",()=>{const a=s.dataset.theme;this.currentTheme=a,e.setAttribute("data-theme",a),localStorage.setItem("rhodium_theme",a),t.forEach(o=>o.classList.remove("active")),s.classList.add("active"),this.showToast(`Tema ${a} aplicado!`,"success"),this.playSound("theme")})})}setupSoundSystem(){this.soundEnabled&&document.body.classList.add("sound-enabled")}playSound(t="click"){if(!this.soundEnabled)return;const e=new(window.AudioContext||window.webkitAudioContext),s=e.createOscillator(),a=e.createGain();switch(s.connect(a),a.connect(e.destination),t){case"click":s.frequency.setValueAtTime(800,e.currentTime),a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1);break;case"success":s.frequency.setValueAtTime(523,e.currentTime),s.frequency.setValueAtTime(659,e.currentTime+.1),a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2);break;case"error":s.frequency.setValueAtTime(200,e.currentTime),a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3);break;case"theme":s.frequency.setValueAtTime(440,e.currentTime),s.frequency.setValueAtTime(880,e.currentTime+.1),a.gain.setValueAtTime(.05,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2);break}s.start(e.currentTime),s.stop(e.currentTime+.3)}setupToastSystem(){this.toastContainer=document.getElementById("toastContainer"),this.toastContainer||(this.toastContainer=document.createElement("div"),this.toastContainer.className="toast-container",this.toastContainer.id="toastContainer",document.body.appendChild(this.toastContainer))}showToast(t,e="info",s=5e3){const a=document.createElement("div");a.className=`toast ${e}`,a.innerHTML=`
          <div>${t}</div>
          <button class="toast-close">&times;</button>
      `,this.toastContainer.appendChild(a),setTimeout(()=>a.classList.add("show"),100);const o=setTimeout(()=>{this.removeToast(a)},s);a.querySelector(".toast-close").addEventListener("click",()=>{clearTimeout(o),this.removeToast(a)}),e==="info"&&a.addEventListener("click",()=>{clearTimeout(o),this.removeToast(a)})}removeToast(t){t.classList.remove("show"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)}setupDragAndDrop(){this.setupNoteDragDrop(),this.setupPageDragDrop()}setupNoteDragDrop(){let t=null;document.addEventListener("dragstart",e=>{e.target.classList.contains("note-card")&&(t=e.target,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move")}),document.addEventListener("dragend",e=>{e.target.classList.contains("note-card")&&(e.target.classList.remove("dragging"),t=null)}),document.addEventListener("dragover",e=>{e.preventDefault(),e.target.closest(".notes-list")&&t&&(e.dataTransfer.dropEffect="move")}),document.addEventListener("drop",e=>{e.preventDefault(),e.target.closest(".notes-list")&&t&&(this.showToast("Nota reorganizada!","success"),this.playSound("success"))})}setupPageDragDrop(){document.addEventListener("dragstart",t=>{t.target.classList.contains("page-card")&&(t.target,t.target.classList.add("dragging"),t.dataTransfer.effectAllowed="move")}),document.addEventListener("dragend",t=>{t.target.classList.contains("page-card")&&t.target.classList.remove("dragging")})}setupScrollSpy(){const t=document.querySelectorAll(".tab-content"),e=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting?a.target.classList.add("scroll-spy","active"):a.target.classList.remove("active")})},{threshold:.1});t.forEach(s=>e.observe(s))}setupLibrarySystem(){this.library=this.getDefaultLibrary(),this.currentPdfUrl=null,this.renderLibrary()}getDefaultLibrary(){return[{id:"1",title:"Dom Casmurro",author:"Machado de Assis",description:"Romance clássico da literatura brasileira que narra a história de Bentinho e Capitu.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00180a.pdf",tags:["Literatura Brasileira","Romance","Clássico"],favorite:!1,category:"Literatura"},{id:"2",title:"O Cortiço",author:"Aluísio Azevedo",description:"Obra naturalista que retrata a vida em um cortiço no Rio de Janeiro do século XIX.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00015a.pdf",tags:["Literatura Brasileira","Naturalismo","Clássico"],favorite:!1,category:"Literatura"},{id:"3",title:"O Alienista",author:"Machado de Assis",description:"Novela satírica sobre a loucura e a razão na sociedade.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00012a.pdf",tags:["Literatura Brasileira","Sátira","Clássico"],favorite:!1,category:"Literatura"},{id:"4",title:"Iracema",author:"José de Alencar",description:"Romance indianista que narra a lenda da fundação do Ceará.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00136a.pdf",tags:["Literatura Brasileira","Romantismo","Indianismo"],favorite:!1,category:"Literatura"},{id:"5",title:"A Moreninha",author:"Joaquim Manuel de Macedo",description:"Romance urbano que retrata a sociedade carioca do século XIX.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00169a.pdf",tags:["Literatura Brasileira","Romance","Século XIX"],favorite:!1,category:"Literatura"},{id:"6",title:"Os Lusíadas",author:"Luís de Camões",description:"Epopeia portuguesa que narra as aventuras de Vasco da Gama.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00162a.pdf",tags:["Literatura Portuguesa","Épico","Clássico"],favorite:!1,category:"Literatura"},{id:"7",title:"Auto da Barca do Inferno",author:"Gil Vicente",description:"Auto teatral que satiriza os vícios da sociedade medieval.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00230a.pdf",tags:["Teatro","Literatura Portuguesa","Medieval"],favorite:!1,category:"Teatro"},{id:"8",title:"Memórias de um Sargento de Milícias",author:"Manuel Antônio de Almeida",description:"Romance que retrata a sociedade carioca do início do século XIX.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00250a.pdf",tags:["Literatura Brasileira","Romance","Século XIX"],favorite:!1,category:"Literatura"},{id:"9",title:"Quincas Borba",author:"Machado de Assis",description:"Romance que explora temas filosóficos através da história de Rubião.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00181a.pdf",tags:["Literatura Brasileira","Filosofia","Romance"],favorite:!1,category:"Literatura"},{id:"10",title:"Senhora",author:"José de Alencar",description:"Romance urbano que critica o casamento por interesse.",pdfUrl:"https://www.dominiopublico.gov.br/download/texto/bv00137a.pdf",tags:["Literatura Brasileira","Romance","Crítica Social"],favorite:!1,category:"Literatura"}]}toggleFavorite(t){const e=this.library.find(s=>s.id===t);e&&(e.favorite=!e.favorite,this.renderLibrary(),this.playSound(e.favorite?"success":"click"))}async openPdfReader(t,e){try{this.currentPdfUrl=t,this.showToast("Carregando PDF...","info");const s=document.createElement("div");s.className="pdf-reader-modal",s.innerHTML=`
                <div class="pdf-reader-container glass">
                    <div class="pdf-reader-header">
                        <h3>${e}</h3>
                        <button class="close-pdf-btn" onclick="app.closePdfReader()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="pdf-reader-content">
                        <iframe src="${t}" width="100%" height="100%" frameborder="0"></iframe>
                    </div>
                </div>
            `,document.body.appendChild(s),this.showToast("PDF carregado com sucesso!","success")}catch(s){console.error("Erro ao carregar PDF:",s),this.showToast("Erro ao carregar PDF. Tente novamente.","error")}}closePdfReader(){const t=document.querySelector(".pdf-reader-modal");t&&document.body.removeChild(t),this.currentPdfUrl=null}searchLibrary(t){const e=this.library.filter(s=>s.title.toLowerCase().includes(t.toLowerCase())||s.author.toLowerCase().includes(t.toLowerCase())||s.tags.some(a=>a.toLowerCase().includes(t.toLowerCase())));this.renderLibrary(e)}renderLibrary(t=this.library){const e=document.getElementById("libraryContainer");e&&(e.innerHTML="",t.forEach(s=>{const a=document.createElement("div");a.className="library-item drag-item",a.innerHTML=`
                <div class="library-content">
                    <h4>${s.title}</h4>
                    <p class="library-author">por ${s.author}</p>
                    <p class="library-description">${s.description}</p>
                    <div class="library-tags">
                        ${s.tags.map(o=>`<span class="tag">${o}</span>`).join("")}
                    </div>
                    <div class="library-actions">
                        ${s.pdfUrl?`<button class="btn-primary library-read-btn" onclick="app.openPdfReader('${s.pdfUrl}', '${s.title}')">
                            <i class="fas fa-book-open"></i> LER
                        </button>`:""}
                        <button class="favorite-btn ${s.favorite?"active":""}" onclick="app.toggleFavorite('${s.id}')">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            `,e.appendChild(a)}))}setupUploadSystem(){document.querySelectorAll(".upload-zone, .drop-zone").forEach(e=>{e.addEventListener("dragenter",s=>{s.preventDefault(),e.classList.add("active")}),e.addEventListener("dragleave",s=>{s.preventDefault(),e.contains(s.relatedTarget)||e.classList.remove("active")}),e.addEventListener("dragover",s=>{s.preventDefault()}),e.addEventListener("drop",s=>{s.preventDefault(),e.classList.remove("active");const a=s.dataTransfer.files;a.length>0&&this.handleFileUpload(a[0],e)})})}handleFileUpload(t,e){this.showUploadProgress(t.name);let s=0;const a=setInterval(()=>{s+=Math.random()*15,s>=100&&(s=100,clearInterval(a),this.showToast(`${t.name} carregado com sucesso!`,"success"),this.playSound("success")),this.updateUploadProgress(s)},200)}showUploadProgress(t){const e=`
          <div class="upload-progress-container">
              <p>Carregando ${t}...</p>
              <div class="upload-progress">
                  <div class="upload-progress-bar" id="uploadProgressBar"></div>
              </div>
          </div>
      `;this.showToast(e,"info",1e4)}updateUploadProgress(t){const e=document.getElementById("uploadProgressBar");e&&(e.style.width=t+"%")}setupSearchSystem(){document.querySelectorAll('input[type="search"], .search-input').forEach(e=>{e.addEventListener("input",s=>{const a=s.target.value.toLowerCase();this.performSearch(a,s.target)})}),document.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="f"&&(e.preventDefault(),this.showGlobalSearch())})}performSearch(t,e){document.querySelectorAll(".page-card, .note-card, .library-item").forEach(a=>{const r=a.textContent.toLowerCase().includes(t);a.style.display=r||t===""?"block":"none",r&&t!==""?this.highlightSearchTerms(a,t):this.removeHighlights(a)})}highlightSearchTerms(t,e){this.getTextNodes(t).forEach(a=>{const o=a.textContent,r=new RegExp(`(${e})`,"gi");if(r.test(o)){const c=o.replace(r,'<span class="search-highlight">$1</span>'),i=document.createElement("div");for(i.innerHTML=c;i.firstChild;)a.parentNode.insertBefore(i.firstChild,a);a.parentNode.removeChild(a)}})}removeHighlights(t){t.querySelectorAll(".search-highlight").forEach(s=>{const a=s.parentNode;a.replaceChild(document.createTextNode(s.textContent),s),a.normalize()})}getTextNodes(t){const e=[],s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let a;for(;a=s.nextNode();)e.push(a);return e}showGlobalSearch(){const t=document.createElement("div");t.className="search-modal",t.innerHTML=`
          <div class="search-modal-content glass">
              <input type="text" class="search-input" placeholder="Pesquisar em todo o Rhodium..." autofocus>
              <div class="search-results"></div>
              <button class="search-close">&times;</button>
          </div>
      `,document.body.appendChild(t),t.querySelector(".search-close").addEventListener("click",()=>{document.body.removeChild(t)}),t.addEventListener("click",s=>{s.target===t&&document.body.removeChild(t)})}setupPDFViewer(){this.pdfViewerState={currentPage:1,totalPages:0,scale:1,highlights:[],comments:[]}}ensureDefaultTheme(){const t=localStorage.getItem("rhodium_theme");t?(this.currentTheme=t,document.body.setAttribute("data-theme",t)):(this.currentTheme="classic",document.body.setAttribute("data-theme","classic"),localStorage.setItem("rhodium_theme","classic"))}setupDevLogs(){this.devLogs=JSON.parse(localStorage.getItem("rhodium_dev_logs")||"[]");const t=console.log,e=console.error,s=console.warn;console.log=(...a)=>{this.addDevLog("log",a.join(" ")),t.apply(console,a)},console.error=(...a)=>{this.addDevLog("error",a.join(" ")),e.apply(console,a)},console.warn=(...a)=>{this.addDevLog("warn",a.join(" ")),s.apply(console,a)}}addDevLog(t,e){const s={type:t,message:e,timestamp:new Date().toISOString(),url:window.location.href};this.devLogs.unshift(s),this.devLogs.length>1e3&&(this.devLogs=this.devLogs.slice(0,1e3)),localStorage.setItem("rhodium_dev_logs",JSON.stringify(this.devLogs))}showDevLogs(t){if(t!=="rhodium_dev_2024")return!1;const e=document.createElement("div");return e.className="dev-log-modal",e.innerHTML=`
          <div class="dev-log-content glass">
              <h3>LOGS DE DESENVOLVIMENTO</h3>
              <div class="dev-log-list">
                  ${this.devLogs.map(s=>`
                      <div class="dev-log-item ${s.type}">
                          <span class="log-time">${new Date(s.timestamp).toLocaleTimeString()}</span>
                          <span class="log-type">[${s.type.toUpperCase()}]</span>
                          <span class="log-message">${s.message}</span>
                      </div>
                  `).join("")}
              </div>
              <button class="log-close">FECHAR</button>
          </div>
      `,document.body.appendChild(e),e.querySelector(".log-close").addEventListener("click",()=>{document.body.removeChild(e)}),!0}showCustomPopup(t,e="info",s=!1){document.querySelectorAll(".custom-popup-overlay").forEach(r=>r.remove());const o=document.createElement("div");o.className="custom-popup-overlay",o.innerHTML=`
            <div class="custom-popup glass ${s?"large":""}">
                <div class="popup-content">
                    <div class="popup-icon ${e}">
                        ${this.getPopupIcon(e)}
                    </div>
                    <div class="popup-message">${t}</div>
                    <button class="popup-btn btn-primary" onclick="this.closest('.custom-popup-overlay').remove()">
                        OK
                    </button>
                </div>
            </div>
        `,document.body.appendChild(o),this.playSound(e==="error"?"error":"success"),e!=="error"&&setTimeout(()=>{o.parentNode&&o.remove()},5e3)}showCustomConfirm(t,e,s=null){const a=document.createElement("div");a.className="custom-popup-overlay",a.innerHTML=`
            <div class="custom-popup glass">
                <div class="popup-content">
                    <div class="popup-icon warning">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="popup-message">${t}</div>
                    <div class="popup-buttons">
                        <button class="popup-btn btn-secondary cancel-btn">CANCELAR</button>
                        <button class="popup-btn btn-primary confirm-btn">CONFIRMAR</button>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(a),a.querySelector(".confirm-btn").addEventListener("click",()=>{a.remove(),e&&e()}),a.querySelector(".cancel-btn").addEventListener("click",()=>{a.remove(),s&&s()}),this.playSound("click")}getPopupIcon(t){const e={success:'<i class="fas fa-check-circle"></i>',error:'<i class="fas fa-exclamation-circle"></i>',warning:'<i class="fas fa-exclamation-triangle"></i>',info:'<i class="fas fa-info-circle"></i>'};return e[t]||e.info}bindEvents(){var r,c,i,l,p,E,b,C,I,d,m,h,v,g,f,D,T,B,y,w,S,x;if(this.eventsInitialized)return;this.eventsInitialized=!0;const t=document.getElementById("loginForm");t&&t.addEventListener("submit",n=>{n.preventDefault();const u=document.getElementById("loginCode").value;this.login(u)});const e=document.getElementById("registerForm");e&&e.addEventListener("submit",n=>{n.preventDefault();const u=document.getElementById("registerName").value;this.register(u)}),(r=document.getElementById("toggleCodeBtn"))==null||r.addEventListener("click",()=>{this.toggleCodeVisibility()}),(c=document.getElementById("showRegister"))==null||c.addEventListener("click",()=>{this.showRegister()}),(i=document.getElementById("showLogin"))==null||i.addEventListener("click",()=>{this.showLogin()}),(l=document.getElementById("logoutBtn"))==null||l.addEventListener("click",()=>{this.logout()}),(p=document.getElementById("settingsBtn"))==null||p.addEventListener("click",()=>{this.showTab("settings"),document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active")),document.querySelector('[data-tab="settings"]').classList.add("active"),this.updateSettingsDisplay()}),(E=document.getElementById("addPageBtn"))==null||E.addEventListener("click",()=>{const n=this.createPage();this.editPage(n.id)}),(b=document.getElementById("savePageBtn"))==null||b.addEventListener("click",()=>{this.savePage()}),(C=document.getElementById("closeEditorBtn"))==null||C.addEventListener("click",()=>{this.hidePageEditor()}),(I=document.getElementById("addNoteBtn"))==null||I.addEventListener("click",()=>{const n=this.createNote();this.editNote(n.id)}),(d=document.getElementById("saveNoteBtn"))==null||d.addEventListener("click",()=>{this.saveNote()}),(m=document.getElementById("closeNoteBtn"))==null||m.addEventListener("click",()=>{this.hideNoteEditor()}),document.querySelectorAll(".toolbar-btn").forEach(n=>{n.addEventListener("click",()=>{const u=n.dataset.action,L=n.dataset.value;if(u==="insertImage"){const A=prompt("URL da imagem:");A&&document.execCommand("insertImage",!1,A)}else if(u==="createLink"){const A=prompt("URL do link:");A&&document.execCommand("createLink",!1,A)}else u==="formatBlock"?document.execCommand(u,!1,L):document.execCommand(u,!1,null)})});const s=document.getElementById("uploadZone"),a=document.getElementById("pdfInput");s.addEventListener("click",()=>{a.click()}),s.addEventListener("dragover",n=>{n.preventDefault(),s.style.background="#e0e0e0"}),s.addEventListener("dragleave",n=>{n.preventDefault(),s.style.background="#f8f8f8"}),s.addEventListener("drop",n=>{n.preventDefault(),s.style.background="#f8f8f8";const u=n.dataTransfer.files;u.length>0&&u[0].type==="application/pdf"&&this.handlePDFUpload(u[0])}),a.addEventListener("change",n=>{n.target.files.length>0&&this.handlePDFUpload(n.target.files[0])}),(h=document.getElementById("summarizePdf"))==null||h.addEventListener("click",()=>{const n=a.files[0];n&&this.processPDF(n,"summarize")}),(v=document.getElementById("extractText"))==null||v.addEventListener("click",()=>{const n=a.files[0];n&&this.processPDF(n,"extract")}),(g=document.getElementById("analyzeStructure"))==null||g.addEventListener("click",()=>{const n=a.files[0];n&&this.processPDF(n,"structure")}),(f=document.getElementById("generateQuestions"))==null||f.addEventListener("click",()=>{const n=a.files[0];n&&this.processPDF(n,"questions")}),(D=document.getElementById("saveSummary"))==null||D.addEventListener("click",()=>{const n=document.getElementById("summaryText").textContent,u=document.getElementById("fileName").textContent;this.createNote(`Resumo: ${u}`,n),this.showToast("Resumo salvo nas suas notas!","success")}),(T=document.getElementById("saveText"))==null||T.addEventListener("click",()=>{const n=document.getElementById("extractedText").textContent,u=document.getElementById("fileName").textContent;this.createNote(`Texto extraído: ${u}`,n),this.showToast("Texto salvo nas suas notas!","success")}),(B=document.getElementById("saveQuestions"))==null||B.addEventListener("click",()=>{const n=document.getElementById("generatedQuestions").innerHTML,u=document.getElementById("fileName").textContent;this.createNote(`Perguntas: ${u}`,n),this.showToast("Perguntas salvas nas suas notas!","success")}),(y=document.getElementById("sendAi"))==null||y.addEventListener("click",()=>{this.sendAIMessage()}),(w=document.getElementById("aiInput"))==null||w.addEventListener("keypress",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),this.sendAIMessage())}),(S=document.getElementById("newChatBtn"))==null||S.addEventListener("click",()=>{this.createNewChat()}),(x=document.getElementById("salvar-config"))==null||x.addEventListener("click",async()=>{var N,k,P;const n=((N=document.getElementById("openaiKey"))==null?void 0:N.value.trim())||"",u=((k=document.getElementById("geminiKey"))==null?void 0:k.value.trim())||"",L=((P=document.getElementById("preferredAI"))==null?void 0:P.value)||"gemini";if(!n&&!u){this.showToast("Pelo menos uma chave deve ser preenchida!","error"),this.playSound("error");return}const A={openaiKey:n,geminiKey:u,preferredAI:L};try{await this.saveUserDataToSupabase(A),this.showToast("Configurações salvas com sucesso!","success"),this.playSound("success")}catch(M){console.error("Erro ao salvar configurações:",M),this.showToast("Erro ao salvar configurações. Tente novamente.","error"),this.playSound("error")}}),this.soundEventsAdded||(this.soundEventsAdded=!0,document.addEventListener("click",n=>{n.target.matches("button, .nav-item, .btn-primary, .btn-secondary")&&this.playSound("click")},{once:!1,passive:!0})),document.addEventListener("keydown",n=>{if(n.ctrlKey&&n.key==="s"&&(n.preventDefault(),this.currentPage?this.savePage():this.currentNote&&this.saveNote(),this.showToast("Salvamento rápido!","success")),n.ctrlKey&&n.key==="n"){n.preventDefault();const u=document.querySelector(".tab-content.active");if(u.id==="workspace"){const L=this.createPage();this.editPage(L.id)}else if(u.id==="notes"){const L=this.createNote();this.editNote(L.id)}}n.key==="Escape"&&(document.getElementById("pageEditor").classList.contains("hidden")||this.hidePageEditor(),document.getElementById("noteEditor").classList.contains("hidden")||this.hideNoteEditor())});let o="";document.addEventListener("keydown",n=>{if(o+=n.key,o.length>20&&(o=o.slice(-20)),o.includes("devlogs")){const u=prompt("Código secreto:");this.showDevLogs(u)&&(o="")}}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(n=>{console.log("Service Worker registration failed:",n)}),window.addEventListener("online",()=>{this.showToast("Conexão restaurada!","success"),this.syncOfflineData()}),window.addEventListener("offline",()=>{this.showToast("Modo offline ativado","warning")})}syncOfflineData(){const t=localStorage.getItem("rhodium_offline_changes");t&&(JSON.parse(t),this.saveUserDataToSupabase(),localStorage.removeItem("rhodium_offline_changes"),this.showToast("Dados sincronizados!","success"))}handlePDFUpload(t){document.getElementById("fileName").textContent=t.name,document.getElementById("pdfPreview").classList.remove("hidden"),document.querySelectorAll(".result-section").forEach(e=>{e.classList.add("hidden")})}createButton(t,e=""){const s=document.createElement("button");return s.className=`btn btn-standard ${e}`,s.textContent=t,s}}const $=new q;window.app=$;window.addEventListener("DOMContentLoaded",()=>{$.init()});
