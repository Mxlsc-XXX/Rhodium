(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();class B{constructor(){this.currentUser=null,this.currentPage=null,this.currentNote=null,this.userData={pages:[],notes:[]},this.isCodeVisible=!1,this.supabaseUrl="https://bchaobnjfrmzvlmqeoge.supabase.co",this.supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJjaGFvYm5qZnJtenZsbXFlb2dlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxMjk0NjMsImV4cCI6MjA2NTcwNTQ2M30.CeH2qS0brRJVCgiskfgTTJwlEqlBMHmc39ZZ8zghtGY",this.supabase=supabase.createClient(this.supabaseUrl,this.supabaseKey),this.init()}init(){this.bindEvents(),this.checkAuthState(),this.setupTabs(),this.setupTextTools(),this.setupAI()}encrypt(e,t="rhodium_secret_key"){let s="";for(let n=0;n<e.length;n++)s+=String.fromCharCode(e.charCodeAt(n)^t.charCodeAt(n%t.length));return btoa(s)}decrypt(e,t="rhodium_secret_key"){try{const s=atob(e);let n="";for(let a=0;a<s.length;a++)n+=String.fromCharCode(s.charCodeAt(a)^t.charCodeAt(a%t.length));return n}catch(s){return console.error("Decryption error:",s),null}}async loadUserDataFromSupabase(){if(!this.currentUser)return;const{data:e,error:t}=await this.supabase.from("Codes").select("user_data, last_saved").eq("code",this.currentUser.code).single();if(t){console.error("Erro ao carregar dados do Supabase:",t);return}if(e&&e.user_data){const s=this.decrypt(e.user_data);s?this.userData=JSON.parse(s):this.initializeUserData()}else this.initializeUserData()}async saveUserDataToSupabase(){if(this.currentUser)try{const e=this.encrypt(JSON.stringify(this.userData)),t=new Date().toISOString(),{error:s}=await this.supabase.from("Codes").update({user_data:e,last_saved:t}).eq("code",this.currentUser.code);s?console.error("Erro ao salvar dados no Supabase:",s):console.log("Dados do usuário salvos no Supabase")}catch(e){console.error("Erro no saveUserDataToSupabase:",e)}}async generateUniqueCode(){let e,t=!0;for(;t;){e=Math.random().toString(36).substring(2,10).toUpperCase();const{data:s,error:n}=await this.supabase.from("Codes").select("code").eq("code",e).limit(1);n?(console.error("Erro ao verificar código único:",n),t=!1):t=s.length>0}return e}async checkAuthState(){const e=localStorage.getItem("rhodium_current_user");e?(this.currentUser=JSON.parse(e),await this.loadUserDataFromSupabase(),this.showMainApp(),this.renderPages(),this.renderNotes()):this.showLogin()}async register(e){if(!e.trim())return alert("Por favor, insira um nome válido."),!1;const t=await this.generateUniqueCode(),s={pages:[],notes:[]},n=this.encrypt(JSON.stringify(s)),a={id:Date.now().toString(),name:e.trim(),code:t,created_at:new Date().toISOString(),last_saved:new Date().toISOString(),user_data:n},{error:r}=await this.supabase.from("Codes").insert(a);return r?(console.error("Erro ao criar conta no Supabase:",r),alert("Erro ao criar conta. Tente novamente."),!1):(this.currentUser={id:a.id,name:a.name,code:a.code,createdAt:a.created_at,lastSaved:a.last_saved},this.userData=s,localStorage.setItem("rhodium_current_user",JSON.stringify(this.currentUser)),this.showMainApp(),this.showGeneratedCode(t),!0)}async login(e){const t=e.trim().toUpperCase(),{data:s,error:n}=await this.supabase.from("Codes").select("*").eq("code",t).single();return n||!s?(alert("Código inválido."),!1):(this.currentUser={id:s.id,name:s.name,code:s.code,createdAt:s.created_at,lastSaved:s.last_saved},localStorage.setItem("rhodium_current_user",JSON.stringify(this.currentUser)),await this.loadUserDataFromSupabase(),this.showMainApp(),this.renderPages(),this.renderNotes(),!0)}showGeneratedCode(e){alert(`Sua conta foi criada com sucesso!

Seu código de acesso é: ${e}

Guarde este código com segurança, você precisará dele para fazer login.`)}logout(){this.currentUser=null,this.userData={pages:[],notes:[]},localStorage.removeItem("rhodium_current_user"),this.showLogin()}toggleCodeVisibility(){this.isCodeVisible=!this.isCodeVisible;const e=document.getElementById("userCodeDisplay"),t=document.getElementById("toggleCodeBtn");this.isCodeVisible?(e.textContent=this.currentUser.code,t.innerHTML='<i class="fas fa-eye-slash"></i>'):(e.textContent="••••••••",t.innerHTML='<i class="fas fa-eye"></i>')}showLogin(){document.getElementById("loginScreen").classList.add("active"),document.getElementById("registerScreen").classList.remove("active"),document.getElementById("mainApp").classList.remove("active")}showRegister(){document.getElementById("loginScreen").classList.remove("active"),document.getElementById("registerScreen").classList.add("active"),document.getElementById("mainApp").classList.remove("active")}showMainApp(){document.getElementById("loginScreen").classList.remove("active"),document.getElementById("registerScreen").classList.remove("active"),document.getElementById("mainApp").classList.add("active"),this.currentUser&&(document.getElementById("userName").textContent=this.currentUser.name,document.getElementById("userCodeDisplay").textContent="••••••••",this.isCodeVisible=!1)}setupTabs(){const e=document.querySelectorAll(".nav-item");e.forEach(t=>{t.addEventListener("click",()=>{const s=t.dataset.tab;this.showTab(s),e.forEach(n=>n.classList.remove("active")),t.classList.add("active")})})}showTab(e){document.querySelectorAll(".tab-content").forEach(s=>s.classList.remove("active")),document.getElementById(e).classList.add("active"),e==="workspace"?this.renderPages():e==="notes"&&this.renderNotes()}initializeUserData(){this.userData={pages:[],notes:[]},this.saveUserDataToSupabase()}saveUserData(){this.saveUserDataToSupabase()}createPage(e="Nova Página",t=""){const s={id:Date.now().toString(),title:e,content:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.userData.pages.push(s),this.saveUserData(),s}editPage(e){const t=this.userData.pages.find(s=>s.id===e);t&&(this.currentPage=t,this.showPageEditor(t))}savePage(){if(this.currentPage){const e=document.getElementById("pageTitle").value,t=document.getElementById("pageContent").innerHTML;this.currentPage.title=e||"Sem título",this.currentPage.content=t,this.currentPage.updatedAt=new Date().toISOString(),this.saveUserData(),this.hidePageEditor(),this.renderPages()}}deletePage(e){confirm("Tem certeza que deseja excluir esta página?")&&(this.userData.pages=this.userData.pages.filter(t=>t.id!==e),this.saveUserData(),this.renderPages())}showPageEditor(e){document.getElementById("pageTitle").value=e.title,document.getElementById("pageContent").innerHTML=e.content,document.getElementById("pageEditor").classList.remove("hidden"),document.getElementById("pagesList").style.display="none"}hidePageEditor(){document.getElementById("pageEditor").classList.add("hidden"),document.getElementById("pagesList").style.display="grid",this.currentPage=null}renderPages(){const e=document.getElementById("pagesList");e.innerHTML="",this.userData.pages.forEach(t=>{const s=document.createElement("div");s.className="page-card",s.innerHTML=`
                <h3>${t.title}</h3>
                <p>${this.stripHtml(t.content).substring(0,100)}${t.content.length>100?"...":""}</p>
                <div class="page-date">Atualizado em ${new Date(t.updatedAt).toLocaleDateString("pt-BR")}</div>
                <div style="margin-top: 15px;">
                    <button onclick="app.editPage('${t.id}')" class="btn-secondary" style="margin-right: 10px;">EDITAR</button>
                    <button onclick="app.deletePage('${t.id}')" class="btn-secondary" style="background: #000000; color: white;">EXCLUIR</button>
                </div>
            `,e.appendChild(s)})}createNote(e="Nova Nota",t=""){const s={id:Date.now().toString(),title:e,content:t,createdAt:new Date().toISOString()};return this.userData.notes.push(s),this.saveUserData(),this.renderNotes(),s}editNote(e){const t=this.userData.notes.find(s=>s.id===e);t&&(this.currentNote=t,this.showNoteEditor(t))}saveNote(){if(this.currentNote){const e=document.getElementById("noteTitle").value,t=document.getElementById("noteContent").innerHTML;this.currentNote.title=e||"Sem título",this.currentNote.content=t,this.saveUserData(),this.hideNoteEditor(),this.renderNotes()}}deleteNote(e){confirm("Tem certeza que deseja excluir esta nota?")&&(this.userData.notes=this.userData.notes.filter(t=>t.id!==e),this.saveUserData(),this.renderNotes())}showNoteEditor(e){document.getElementById("noteTitle").value=e.title,document.getElementById("noteContent").innerHTML=e.content,document.getElementById("noteEditor").classList.remove("hidden"),document.getElementById("notesList").style.display="none"}hideNoteEditor(){document.getElementById("noteEditor").classList.add("hidden"),document.getElementById("notesList").style.display="grid",this.currentNote=null}renderNotes(){const e=document.getElementById("notesList");e.innerHTML="",this.userData.notes.forEach(t=>{const s=document.createElement("div");s.className="note-card",s.innerHTML=`
                <h3>${t.title}</h3>
                <p>${this.stripHtml(t.content).substring(0,150)}${t.content.length>150?"...":""}</p>
                <div class="note-date">Criado em ${new Date(t.createdAt).toLocaleDateString("pt-BR")}</div>
                <div style="margin-top: 15px;">
                    <button onclick="app.editNote('${t.id}')" class="btn-secondary" style="margin-right: 10px;">EDITAR</button>
                    <button onclick="app.deleteNote('${t.id}')" class="btn-secondary" style="background: #000000; color: white;">EXCLUIR</button>
                </div>
            `,e.appendChild(s)})}async processPDF(e,t="summarize"){try{document.getElementById("loadingOverlay").classList.remove("hidden");const s=await e.arrayBuffer(),n=await pdfjsLib.getDocument(s).promise;let a="",r={totalPages:n.numPages,pageTexts:[],headings:[],paragraphs:[]};for(let i=1;i<=n.numPages;i++){const u=(await(await n.getPage(i)).getTextContent()).items.map(m=>m.str).join(" ");a+=u+`
`,r.pageTexts.push({page:i,text:u,wordCount:u.split(" ").length})}switch(t){case"summarize":const i=this.generateSummary(a);document.getElementById("summaryText").textContent=i,document.getElementById("summaryResult").classList.remove("hidden");break;case"extract":document.getElementById("extractedText").textContent=a,document.getElementById("textResult").classList.remove("hidden");break;case"structure":this.analyzeStructure(a,r);break;case"questions":const c=this.generateQuestions(a);document.getElementById("generatedQuestions").innerHTML=c,document.getElementById("questionsResult").classList.remove("hidden");break}}catch(s){console.error("PDF processing error:",s),alert("Erro ao processar PDF. Verifique se o arquivo é válido.")}finally{document.getElementById("loadingOverlay").classList.add("hidden")}}generateSummary(e){const t=e.split(/[.!?]+/).filter(c=>c.trim().length>0),s=e.toLowerCase().split(/\s+/),n={};s.forEach(c=>{const l=c.replace(/[^\w]/g,"");l.length>3&&(n[l]=(n[l]||0)+1)});const a=t.map(c=>{const l=c.toLowerCase().split(/\s+/);let u=0;return l.forEach(m=>{const g=m.replace(/[^\w]/g,"");n[g]&&(u+=n[g])}),{sentence:c.trim(),score:u}});a.sort((c,l)=>l.score-c.score);const r=Math.min(8,Math.ceil(t.length*.4));return a.slice(0,r).map(c=>c.sentence).join(". ")+"."}analyzeStructure(e,t){const s=e.split(`
`),n=[],a=[];s.forEach((i,c)=>{const l=i.trim();l.length>0&&(l.length<100&&/^[A-Z]/.test(l)?n.push(`Linha ${c+1}: ${l}`):l.length>50&&a.push(`Parágrafo ${a.length+1}: ${l.substring(0,100)}...`))});const r=`
            <h4>INFORMAÇÕES GERAIS:</h4>
            <p>Total de páginas: ${t.totalPages}</p>
            <p>Total de palavras: ${e.split(" ").length}</p>
            <p>Total de caracteres: ${e.length}</p>
            
            <h4>POSSÍVEIS TÍTULOS/CABEÇALHOS:</h4>
            <ul>${n.slice(0,10).map(i=>`<li>${i}</li>`).join("")}</ul>
            
            <h4>ESTRUTURA DE PARÁGRAFOS:</h4>
            <ul>${a.slice(0,5).map(i=>`<li>${i}</li>`).join("")}</ul>
        `;document.getElementById("documentStructure").innerHTML=r,document.getElementById("structureResult").classList.remove("hidden")}generateQuestions(e){const t=e.split(/[.!?]+/).filter(r=>r.trim().length>20),s=this.extractKeywords(e),n=[];return s.slice(0,5).forEach(r=>{n.push(`O que é ${r}?`),n.push(`Como ${r} se relaciona com o tema principal?`)}),t.filter(r=>r.length>50&&r.length<200).slice(0,3).forEach(r=>{r.includes("porque")||r.includes("causa")?n.push(`Por que ${r.split(" ").slice(0,5).join(" ")}...?`):n.push(`Explique: ${r.substring(0,80)}...`)}),n.map((r,i)=>`<p><strong>Pergunta ${i+1}:</strong> ${r}</p>`).join("")}extractKeywords(e){const t=e.toLowerCase().split(/\s+/),s=new Set(["o","a","os","as","um","uma","de","do","da","dos","das","em","no","na","nos","nas","para","por","com","sem","sob","sobre","entre","até","desde","durante","através","mediante","conforme","segundo","perante","ante","após","antes","contra","desde","exceto","salvo","menos","mais","muito","pouco","tanto","quanto","qual","que","quem","onde","quando","como","porque","se","mas","ou","e","nem","também","já","ainda","só","apenas","mesmo","até","inclusive","exclusive"]),n={};return t.forEach(a=>{const r=a.replace(/[^\w]/g,"");r.length>4&&!s.has(r)&&(n[r]=(n[r]||0)+1)}),Object.entries(n).sort((a,r)=>r[1]-a[1]).slice(0,10).map(a=>a[0])}setupTextTools(){var s,n,a,r;const e=document.getElementById("wordCountText"),t=document.getElementById("formatText");e&&e.addEventListener("input",()=>{const i=e.value;document.getElementById("charCount").textContent=i.length,document.getElementById("wordCount").textContent=i.split(/\s+/).filter(c=>c.length>0).length,document.getElementById("paragraphCount").textContent=i.split(`
`).filter(c=>c.trim().length>0).length}),(s=document.getElementById("upperCase"))==null||s.addEventListener("click",()=>{const i=t.value;document.getElementById("formatResult").value=i.toUpperCase()}),(n=document.getElementById("lowerCase"))==null||n.addEventListener("click",()=>{const i=t.value;document.getElementById("formatResult").value=i.toLowerCase()}),(a=document.getElementById("titleCase"))==null||a.addEventListener("click",()=>{const i=t.value;document.getElementById("formatResult").value=i.replace(/\w\S*/g,c=>c.charAt(0).toUpperCase()+c.substr(1).toLowerCase())}),(r=document.getElementById("removeSpaces"))==null||r.addEventListener("click",()=>{const i=t.value;document.getElementById("formatResult").value=i.replace(/\s+/g," ").trim()})}setupAI(){document.getElementById("chatMessages"),document.querySelectorAll(".ai-tool-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.prompt;document.getElementById("aiInput").value=t})})}sendAIMessage(e){const t=document.getElementById("chatMessages"),s=document.createElement("div");s.className="message user",s.textContent=e,t.appendChild(s),setTimeout(()=>{const n=document.createElement("div");n.className="message ai",n.textContent=this.generateAIResponse(e),t.appendChild(n),t.scrollTop=t.scrollHeight},1e3),t.scrollTop=t.scrollHeight}generateAIResponse(e){const t={resumir:"Para resumir um texto, identifique as ideias principais e elimine informações redundantes.",traduzir:"Para tradução precisa, considere o contexto e as nuances culturais.",corrigir:"Verificando gramática e ortografia do texto fornecido.",explicar:"Vou explicar o conceito de forma clara e didática."},s=e.toLowerCase();for(const n in t)if(s.includes(n))return t[n];return"Estou aqui para ajudar! Posso resumir textos, traduzir, corrigir gramática ou explicar conceitos. Como posso ajudá-lo?"}stripHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}bindEvents(){var s,n,a,r,i,c,l,u,m,g,p,f,y,E;document.getElementById("loginForm").addEventListener("submit",o=>{o.preventDefault();const d=document.getElementById("loginCode").value;this.login(d)}),document.getElementById("registerForm").addEventListener("submit",o=>{o.preventDefault();const d=document.getElementById("registerName").value;this.register(d)}),(s=document.getElementById("toggleCodeBtn"))==null||s.addEventListener("click",()=>{this.toggleCodeVisibility()}),document.getElementById("showRegister").addEventListener("click",()=>{this.showRegister()}),document.getElementById("showLogin").addEventListener("click",()=>{this.showLogin()}),document.getElementById("logoutBtn").addEventListener("click",()=>{this.logout()}),(n=document.getElementById("settingsBtn"))==null||n.addEventListener("click",()=>{this.showTab("settings"),document.querySelectorAll(".nav-item").forEach(o=>o.classList.remove("active")),document.querySelector('[data-tab="settings"]').classList.add("active"),this.currentUser&&(document.getElementById("settingsUserName").textContent=this.currentUser.name)}),document.getElementById("addPageBtn").addEventListener("click",()=>{const o=this.createPage();this.editPage(o.id)}),document.getElementById("savePageBtn").addEventListener("click",()=>{this.savePage()}),document.getElementById("closeEditorBtn").addEventListener("click",()=>{this.hidePageEditor()}),(a=document.getElementById("addNoteBtn"))==null||a.addEventListener("click",()=>{const o=this.createNote();this.editNote(o.id)}),(r=document.getElementById("saveNoteBtn"))==null||r.addEventListener("click",()=>{this.saveNote()}),(i=document.getElementById("closeNoteBtn"))==null||i.addEventListener("click",()=>{this.hideNoteEditor()}),document.querySelectorAll(".toolbar-btn").forEach(o=>{o.addEventListener("click",()=>{const d=o.dataset.action,I=o.dataset.value;if(d==="insertImage"){const h=prompt("URL da imagem:");h&&document.execCommand("insertImage",!1,h)}else if(d==="createLink"){const h=prompt("URL do link:");h&&document.execCommand("createLink",!1,h)}else d==="formatBlock"?document.execCommand(d,!1,I):document.execCommand(d,!1,null)})});const e=document.getElementById("uploadZone"),t=document.getElementById("pdfInput");e.addEventListener("click",()=>{t.click()}),e.addEventListener("dragover",o=>{o.preventDefault(),e.style.background="#e0e0e0"}),e.addEventListener("dragleave",o=>{o.preventDefault(),e.style.background="#f8f8f8"}),e.addEventListener("drop",o=>{o.preventDefault(),e.style.background="#f8f8f8";const d=o.dataTransfer.files;d.length>0&&d[0].type==="application/pdf"&&this.handlePDFUpload(d[0])}),t.addEventListener("change",o=>{o.target.files.length>0&&this.handlePDFUpload(o.target.files[0])}),(c=document.getElementById("summarizePdf"))==null||c.addEventListener("click",()=>{const o=t.files[0];o&&this.processPDF(o,"summarize")}),(l=document.getElementById("extractText"))==null||l.addEventListener("click",()=>{const o=t.files[0];o&&this.processPDF(o,"extract")}),(u=document.getElementById("analyzeStructure"))==null||u.addEventListener("click",()=>{const o=t.files[0];o&&this.processPDF(o,"structure")}),(m=document.getElementById("generateQuestions"))==null||m.addEventListener("click",()=>{const o=t.files[0];o&&this.processPDF(o,"questions")}),(g=document.getElementById("saveSummary"))==null||g.addEventListener("click",()=>{const o=document.getElementById("summaryText").textContent,d=document.getElementById("fileName").textContent;this.createNote(`Resumo: ${d}`,o),alert("Resumo salvo nas suas notas!")}),(p=document.getElementById("saveText"))==null||p.addEventListener("click",()=>{const o=document.getElementById("extractedText").textContent,d=document.getElementById("fileName").textContent;this.createNote(`Texto extraído: ${d}`,o),alert("Texto salvo nas suas notas!")}),(f=document.getElementById("saveQuestions"))==null||f.addEventListener("click",()=>{const o=document.getElementById("generatedQuestions").innerHTML,d=document.getElementById("fileName").textContent;this.createNote(`Perguntas: ${d}`,o),alert("Perguntas salvas nas suas notas!")}),(y=document.getElementById("sendAi"))==null||y.addEventListener("click",()=>{const o=document.getElementById("aiInput"),d=o.value.trim();d&&(this.sendAIMessage(d),o.value="")}),(E=document.getElementById("aiInput"))==null||E.addEventListener("keypress",o=>{o.key==="Enter"&&document.getElementById("sendAi").click()})}handlePDFUpload(e){document.getElementById("fileName").textContent=e.name,document.getElementById("pdfPreview").classList.remove("hidden"),document.querySelectorAll(".result-section").forEach(t=>{t.classList.add("hidden")})}}new B;
